<mat-card>
  <mat-card-title>
    <div *ngIf="!!user.id">
      User {{user.username}}
    </div>
    <div *ngIf="!user.id">
      New User
    </div>
  </mat-card-title>
  <!-- Create and edit mode -->
  <ng-container *ngIf="mode == EditViewMode.CREATE || mode == EditViewMode.EDIT">
    <form (ngSubmit)="onSave()" [formGroup]="userForm">
      <mat-card-content>
        <mat-form-field>
          <mat-label>Username</mat-label>
          <input
            autocomplete="username"
            [formControl]="userForm.controls.username"
            matInput
            required
          />
          <mat-error *ngIf="userForm.get('username')?.hasError('minlength')">Usernames must be at least 3 characters
            long!
          </mat-error>
          <mat-error *ngIf="userForm.get('username')?.hasError('required')">You must enter a username</mat-error>
          <mat-error *ngIf="userForm.get('username')?.hasError('used')">This username is already in use</mat-error>
        </mat-form-field>
        <br/>
        <br/>
        <br/>
        <mat-form-field appearance="outline">
          <mat-label>EMail</mat-label>
          <input
            autocomplete="email"
            email="true"
            [formControl]="userForm.controls.email"
            matInput
            required
            type="email"/>
          <mat-error *ngIf="userForm.get('email')?.hasError('required')">You must enter a email</mat-error>
          <mat-error *ngIf="userForm.get('email')?.hasError('used')">This email is already in use</mat-error>
          <mat-error *ngIf="userForm.get('email')?.hasError('email')">The entered email is invalid</mat-error>
        </mat-form-field>
        <br/>
        <br/>
        <br/>
        <mat-form-field appearance="fill">
          <mat-label>User Type</mat-label>
          <mat-select
            [formControl]="userForm.controls.type"
            required>
            <mat-option *ngFor="let type of userTypes" [value]="type.id">{{type.name}}</mat-option>
            <mat-error *ngIf="userForm.get('type')?.hasError('required')">You must set a user type</mat-error>
          </mat-select>
        </mat-form-field>
        <ng-container *ngIf="mode == EditViewMode.CREATE">
          <p>The user will be created with a random password, please change it immediately!</p>
        </ng-container>
      </mat-card-content>
      <mat-card-actions>
        <button [disabled]="userForm.invalid" color="primary" mat-raised-button type="submit">
          Save
        </button>
        <button (click)="onReset()" color="primary" mat-raised-button type="button">
          Reset
        </button>
        <button (click)="changeMode(EditViewMode.EDIT, EditViewMode.VIEW)" *ngIf="mode == EditViewMode.EDIT"
                color="primary" mat-raised-button type="button">
          Cancel
        </button>
      </mat-card-actions>
    </form>
  </ng-container>

  <!-- View mode -->
  <ng-container *ngIf="mode == EditViewMode.VIEW">
    <mat-card-content>
      <p>Username: {{user.username}}</p>
      <p>EMail: {{user.email}}</p>
      <p>Type: {{user.type?.name ?? ''}}</p>
    </mat-card-content>
    <mat-card-actions>
      <button (click)="changeMode(EditViewMode.VIEW, EditViewMode.EDIT)" *ngIf="canEdit" color="primary"
              mat-raised-button type="button">
        Edit
      </button>
      <button (click)="changePassword()" *ngIf="canChangePassword" color="primary" mat-raised-button type="button">
        Change Password
      </button>
    </mat-card-actions>
  </ng-container>
</mat-card>
